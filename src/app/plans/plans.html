<!-- En-tête de la page -->
<header class="bg-white shadow-sm sticky top-0 z-10 py-2">
    <nav class="container mx-auto px-4 px-sm-3 px-lg-5 py-2 d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
            <img alt="Logo SMAC" class="h-8" src="favicon.ico">
            <span class="text-xl fs-5 fw-bold text-black">{{ title }}</span>
        </div>
        <div class="d-flex align-items-center flex-row gap-3 text-gray-600">
            <span class="d-flex flex-row text-end align-items-center gap-2">
                <span>{{ c_user.prenom ?? 'NaN' }} {{ c_user.nom ?? 'NaN' }}</span>|
                <span>{{ c_user.matricule ?? 'NaN' }}</span>
            </span>
            <button class="btn logout-btn fw-medium text-gray-600 transition-colors duration-300">
                Déconnexion
            </button>
        </div>
    </nav>
</header>

<main class="container-fluid mx-auto px-5 px-sm-5 px-lg-5 py-3 py-md-5 d-flex justify-content-center"
      style="background-color: var(--app-color-primary);)">

    <div class="main-body">
        <div class="text-center mb-5">
            <h2 class="fw-bold text-white">Votre Versement Volontaire</h2>
            <p class="mt-2 text-lg text-light fs-5">Renseignez votre choix de plan et les montants souhaités.</p>
        </div>

        <!-- Section Information Abondement -->
        <div class="mx-auto bg-white rounded-2 border-danger p-2 p-sm-3 p-lg-3 rounded-lg mb-sm-5 mb-lg-5 shadow-lg">
            <div class="d-flex align-items-start gap-3">
                <i class="bi bi-info-circle fs-4 fw-bold" style="color: var(--app-color-primary)"></i>
                <div class="ml-4">
                    <h4 class="font-bold text-lg text-gray-600-900 mb-1">Information sur l'abondement de
                        l'entreprise</h4>
                    <p class="text-base fs-6">Pour encourager votre épargne, notre entreprise abonde vos versements
                        selon un barème progressif par tranches, jusqu'à un plafond annuel de <strong>1 350€</strong>.
                        Cliquez sur le bouton 'i' à côté du choix de plafonnement pour voir le détail du calcul.</p>
                </div>
            </div>
        </div>
        <!-- Plan REGARD ÉPARGNE Prudent -->
        <form (submit)="submit()" [formGroup]="form">
            <div
                class="plan-card bg-white p-5 shadow-lg flex-col border-2 border-transparent transition-all duration-300 hover:shadow-xl hover:scale-105 text-gray-600-800">

                <!-- Choix du Plan -->
                <div class="mb-4">
                    <label class="text-lg fw-semibold text-gray-900 mb-3 fs-5">1. Choisissez votre plan
                        d'épargne</label>
                    <div class="d-flex justify-content-between gap-4">
                        <label [class.active-plan]="form.get('plan')?.value === 'prudent'" class="plan-prudent"
                               for="plan-prudent">
                            <input formControlName="plan" id="plan-prudent" type="radio" value="prudent">
                            <span class="plan-card-span">
                                <span class="plan-card-span-child1">Plan REGARD ÉPARGNE</span>
                                <span class="plan-card-span-child2">Prudent</span>
                            </span>
                        </label>
                        <label [class.active-plan]="form.get('plan')?.value === 'flexible'" class="plan-flexible"
                               for="plan-flexible">
                            <input formControlName="plan" id="plan-flexible" type="radio" value="flexible">
                            <span class="plan-card-span">
                                <span class="plan-card-span-child1">Plan REGARD ÉPARGNE</span>
                                <span class="plan-card-span-child2">Flexible & Solidaire</span>
                            </span>
                        </label>
                    </div>
                </div>

                <div class="mt-auto text-left space-y-4">
                    <div>
                        <label class="fw-medium text-gray-700 mb-1 fs-6" for="amount-prudent">2. Je souhaite effectuer
                            un versement sur le PEG (plan à 5 ans) d'un montant total de :
                            <button (click)="openModal(0)" class="btn m-0 p-0 fw-bold border-0" type="button">
                                <i class="bi bi-info-circle-fill fw-bold" style="color: var(--bs-secondary)"></i>
                            </button>
                        </label>
                        <div class="relative">
                            <input class="amount-input" formControlName="montant" id="amount-prudent"
                                   placeholder="500" type="number">
                            <span class="plan-currency text-gray-500"><i class="bi bi-currency-euro m-0 p-0"></i></span>
                        </div>
                    </div>
                    <div class="p-3 my-3 rounded-3 d-flex flex-column gap-1" style="background-color: #f6f8fa">
                        <label class="block font-medium text-gray-600 fs-6">Abondement entreprise (+)</label>
                        <span class="abondement-output fs-5 fw-bold mt-1"
                              id="abondement-prudent">{{ this.abondementOutput | currency:'EUR' }}</span>
                    </div>
                    <div class="my-4">
                        <label class="fw-medium text-gray-700 mb-2">3. Je souhaite que mon versement soit plafonné au
                            montant d’abondement maximum que je peux percevoir sur 2025 :
                        </label>
                        <div class="plafond mt-1">
                            <label for="plafond-prudent-oui">
                                <input formControlName="plafond" id="plafond-prudent-oui" type="radio" value="true">
                                <span class="text-gray-700">Oui</span>
                            </label>
                            <label for="plafond-prudent-non">
                                <input formControlName="plafond" id="plafond-prudent-non" type="radio" value="false">
                                <span class="text-gray-700">Non</span>
                            </label>
                            <button (click)="openModal(1)" class="btn m-0 p-0 fw-bold border-0" type="button">
                                <i class="bi bi-info-circle-fill fw-bold" style="color: var(--bs-secondary)"></i>
                            </button>
                        </div>
                    </div>
                    <label class="fw-medium text-gray-700 mb-2">4. Répartir ce montant sur
                        les prélèvements sur paie suivants :</label>
                    <div class="d-flex flex-row gap-3 prelevements-amount">
                        <div class="novembre-prudent">
                            <label class="fw-medium text-gray-700" for="novembre-prudent">Novembre 2025</label>
                            <div class="relative">
                                <input formControlName="novemberAmount" id="novembre-prudent" placeholder="0"
                                       type="number">
                                <span class="plan-currency text-gray-500"><i
                                    class="bi bi-currency-euro m-0 p-0"></i></span>
                            </div>
                        </div>
                        <div class="decembre-prudent">
                            <label class="fw-medium text-gray-700" for="decembre-prudent">Décembre 2025</label>
                            <div class="relative">
                                <input formControlName="decemberAmount" id="decembre-prudent" placeholder="0"
                                       type="number">
                                <span class="plan-currency text-gray-500"><i
                                    class="bi bi-currency-euro m-0 p-0"></i></span>
                            </div>
                        </div>
                    </div>
                    @if (invalidPrelevement) {
                        <div>
                            <label class="fw-medium text-gray-700 mb-2" style="color: var(--app-color-primary)">La somme
                                des prélèvements doit être égale au montant total du versement.</label>
                        </div>
                    }
                    <button [disabled]="form.invalid || invalidPrelevement"
                            class="select-plan-btn btn w-100 fw-semibold mt-4"
                            type="submit">
                        Choisir ce plan
                    </button>
                </div>
            </div>
        </form>
    </div>
</main>

<!-- Pied de page -->
<footer class="bg-white mt-12">
    <div class="container mx-auto py-3 py-sm-2 py-lg-4 text-center text-gray-500 text-sm">
        <p class="m-0">
            <i class="bi bi-c-circle"></i>
            2025 PLAN D’ÉPARGNE SALARIALE GROUPE SMAC. Tous droits réservés.
        </p>
    </div>
</footer>
<!--

&lt;!&ndash; Modale de confirmation &ndash;&gt;
<div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <h2 class="text-2xl font-bold text-gray-600-900 mb-6">Confirmer votre souscription</h2>

        <h3 class="text-lg font-semibold text-gray-600-800 mb-4 border-b pb-2">IDENTIFICATION</h3>

        <form id="identification-form" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 text-gray-600-800">
            <div>
                <label for="societe" class="block text-sm font-medium text-gray-700">Société*</label>
                <input type="text" id="societe" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="etablissement" class="block text-sm font-medium text-gray-700">Etablissement*</label>
                <input type="text" id="etablissement" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="nom" class="block text-sm font-medium text-gray-700">Nom*</label>
                <input type="text" id="nom" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="prenom" class="block text-sm font-medium text-gray-700">Prénom*</label>
                <input type="text" id="prenom" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div class="md:col-span-2">
                <label for="rue" class="block text-sm font-medium text-gray-700">Rue (n° et nom)*</label>
                <input type="text" id="rue" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="code-postal" class="block text-sm font-medium text-gray-700">Code postal*</label>
                <input type="text" id="code-postal" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="ville" class="block text-sm font-medium text-gray-700">Ville*</label>
                <input type="text" id="ville" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="pays" class="block text-sm font-medium text-gray-700">Pays*</label>
                <input type="text" id="pays" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="date-naissance" class="block text-sm font-medium text-gray-700">Né(e) le*</label>
                <input type="date" id="date-naissance" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div class="md:col-span-2">
                <label for="lieu-naissance" class="block text-sm font-medium text-gray-700">à (ville, pays)*</label>
                <input type="text" id="lieu-naissance" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="telephone" class="block text-sm font-medium text-gray-700">Téléphone*</label>
                <input type="tel" id="telephone" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700">Email*</label>
                <input type="email" id="email" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>
            <div>
                <label for="matricule" class="block text-sm font-medium text-gray-700">N° matricule*</label>
                <input type="text" id="matricule" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500">
            </div>

            <div class="md:col-span-2 mt-6 pt-4 border-t">
                <label for="social-security" class="block text-sm font-medium text-gray-700 mb-2">Numéro de sécurité sociale*</label>
                <input type="text" id="social-security" name="social-security" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 transition" placeholder="1 85 01 75 123 456">
            </div>
        </form>

        <p id="modal-error" class="text-red-500 text-sm mt-4 hidden">Veuillez remplir tous les champs obligatoires (*).</p>

        <div class="mt-8 flex justify-end space-x-4">
            <button id="cancel-btn" class="px-6 py-2 bg-gray-200 text-gray-600-800 font-semibold rounded-md hover:bg-gray-300 transition">Annuler</button>
            <button id="confirm-btn" class="px-6 py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 transition">Confirmer</button>
        </div>
    </div>
</div>

&lt;!&ndash; Modale de Succès &ndash;&gt;
<div id="success-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full mx-4 text-center text-gray-600-800">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
            <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-600-900 mb-2">Merci !</h2>
        <p class="text-gray-700 mb-6">Votre souscription a bien été enregistrée.</p>
        <button id="close-success-btn" class="px-6 py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 transition">Fermer</button>
    </div>
</div>

&lt;!&ndash; Modale d'Information Plafonnement &ndash;&gt;
<div id="info-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full mx-4 text-gray-600-800">
        <h2 class="text-2xl font-bold text-gray-600-900 mb-4">Information Importante</h2>
        <p class="text-gray-700 mb-6">*Important : cas de figure où il y aurait sursouscription (le montant global maximal 2025 d’abondement de 1 480 560 euros serait atteint), voir plaquette du PEG SMAC 2025. Dans cette hypothèse (si le « Non* » est entouré), l’ensemble des versements demandés par le collaborateur sera investi dans le PEG SMAC, mais une partie ne génèrera pas d’abondement.</p>
        <div class="text-right">
            <button id="close-info-btn" class="px-6 py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 transition">J'ai compris</button>
        </div>
    </div>
</div>
-->
